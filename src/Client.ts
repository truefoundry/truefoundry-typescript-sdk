// This file was auto-generated by Fern from our API Definition.

import type * as TrueFoundry from "./api/index.js";
import { AlertsClient } from "./api/resources/alerts/client/Client.js";
import { ApplicationsClient } from "./api/resources/applications/client/Client.js";
import { ApplicationVersionsClient } from "./api/resources/applicationVersions/client/Client.js";
import { ArtifactsClient } from "./api/resources/artifacts/client/Client.js";
import { ArtifactVersionsClient } from "./api/resources/artifactVersions/client/Client.js";
import { ClustersClient } from "./api/resources/clusters/client/Client.js";
import { DataDirectoriesClient } from "./api/resources/dataDirectories/client/Client.js";
import { EnvironmentsClient } from "./api/resources/environments/client/Client.js";
import { EventsClient } from "./api/resources/events/client/Client.js";
import { InternalClient } from "./api/resources/internal/client/Client.js";
import { JobsClient } from "./api/resources/jobs/client/Client.js";
import { LogsClient } from "./api/resources/logs/client/Client.js";
import { MlReposClient } from "./api/resources/mlRepos/client/Client.js";
import { ModelsClient } from "./api/resources/models/client/Client.js";
import { ModelVersionsClient } from "./api/resources/modelVersions/client/Client.js";
import { PersonalAccessTokensClient } from "./api/resources/personalAccessTokens/client/Client.js";
import { PromptsClient } from "./api/resources/prompts/client/Client.js";
import { PromptVersionsClient } from "./api/resources/promptVersions/client/Client.js";
import { SecretGroupsClient } from "./api/resources/secretGroups/client/Client.js";
import { SecretsClient } from "./api/resources/secrets/client/Client.js";
import { TeamsClient } from "./api/resources/teams/client/Client.js";
import { TracesClient } from "./api/resources/traces/client/Client.js";
import { UsersClient } from "./api/resources/users/client/Client.js";
import { VirtualAccountsClient } from "./api/resources/virtualAccounts/client/Client.js";
import { WorkspacesClient } from "./api/resources/workspaces/client/Client.js";
import type { BaseClientOptions, BaseRequestOptions } from "./BaseClient.js";
import { type NormalizedClientOptionsWithAuth, normalizeClientOptionsWithAuth } from "./BaseClient.js";
import { mergeHeaders } from "./core/headers.js";
import * as core from "./core/index.js";
import { handleNonStatusCodeError } from "./errors/handleNonStatusCodeError.js";
import * as errors from "./errors/index.js";

export declare namespace TrueFoundryClient {
    export type Options = BaseClientOptions;

    export interface RequestOptions extends BaseRequestOptions {}
}

export class TrueFoundryClient {
    protected readonly _options: NormalizedClientOptionsWithAuth<TrueFoundryClient.Options>;
    protected _internal: InternalClient | undefined;
    protected _users: UsersClient | undefined;
    protected _teams: TeamsClient | undefined;
    protected _personalAccessTokens: PersonalAccessTokensClient | undefined;
    protected _virtualAccounts: VirtualAccountsClient | undefined;
    protected _clusters: ClustersClient | undefined;
    protected _applications: ApplicationsClient | undefined;
    protected _applicationVersions: ApplicationVersionsClient | undefined;
    protected _jobs: JobsClient | undefined;
    protected _workspaces: WorkspacesClient | undefined;
    protected _environments: EnvironmentsClient | undefined;
    protected _secrets: SecretsClient | undefined;
    protected _secretGroups: SecretGroupsClient | undefined;
    protected _events: EventsClient | undefined;
    protected _alerts: AlertsClient | undefined;
    protected _logs: LogsClient | undefined;
    protected _mlRepos: MlReposClient | undefined;
    protected _traces: TracesClient | undefined;
    protected _artifacts: ArtifactsClient | undefined;
    protected _prompts: PromptsClient | undefined;
    protected _models: ModelsClient | undefined;
    protected _artifactVersions: ArtifactVersionsClient | undefined;
    protected _modelVersions: ModelVersionsClient | undefined;
    protected _promptVersions: PromptVersionsClient | undefined;
    protected _dataDirectories: DataDirectoriesClient | undefined;

    constructor(options: TrueFoundryClient.Options) {
        this._options = normalizeClientOptionsWithAuth(options);
    }

    public get internal(): InternalClient {
        return (this._internal ??= new InternalClient(this._options));
    }

    public get users(): UsersClient {
        return (this._users ??= new UsersClient(this._options));
    }

    public get teams(): TeamsClient {
        return (this._teams ??= new TeamsClient(this._options));
    }

    public get personalAccessTokens(): PersonalAccessTokensClient {
        return (this._personalAccessTokens ??= new PersonalAccessTokensClient(this._options));
    }

    public get virtualAccounts(): VirtualAccountsClient {
        return (this._virtualAccounts ??= new VirtualAccountsClient(this._options));
    }

    public get clusters(): ClustersClient {
        return (this._clusters ??= new ClustersClient(this._options));
    }

    public get applications(): ApplicationsClient {
        return (this._applications ??= new ApplicationsClient(this._options));
    }

    public get applicationVersions(): ApplicationVersionsClient {
        return (this._applicationVersions ??= new ApplicationVersionsClient(this._options));
    }

    public get jobs(): JobsClient {
        return (this._jobs ??= new JobsClient(this._options));
    }

    public get workspaces(): WorkspacesClient {
        return (this._workspaces ??= new WorkspacesClient(this._options));
    }

    public get environments(): EnvironmentsClient {
        return (this._environments ??= new EnvironmentsClient(this._options));
    }

    public get secrets(): SecretsClient {
        return (this._secrets ??= new SecretsClient(this._options));
    }

    public get secretGroups(): SecretGroupsClient {
        return (this._secretGroups ??= new SecretGroupsClient(this._options));
    }

    public get events(): EventsClient {
        return (this._events ??= new EventsClient(this._options));
    }

    public get alerts(): AlertsClient {
        return (this._alerts ??= new AlertsClient(this._options));
    }

    public get logs(): LogsClient {
        return (this._logs ??= new LogsClient(this._options));
    }

    public get mlRepos(): MlReposClient {
        return (this._mlRepos ??= new MlReposClient(this._options));
    }

    public get traces(): TracesClient {
        return (this._traces ??= new TracesClient(this._options));
    }

    public get artifacts(): ArtifactsClient {
        return (this._artifacts ??= new ArtifactsClient(this._options));
    }

    public get prompts(): PromptsClient {
        return (this._prompts ??= new PromptsClient(this._options));
    }

    public get models(): ModelsClient {
        return (this._models ??= new ModelsClient(this._options));
    }

    public get artifactVersions(): ArtifactVersionsClient {
        return (this._artifactVersions ??= new ArtifactVersionsClient(this._options));
    }

    public get modelVersions(): ModelVersionsClient {
        return (this._modelVersions ??= new ModelVersionsClient(this._options));
    }

    public get promptVersions(): PromptVersionsClient {
        return (this._promptVersions ??= new PromptVersionsClient(this._options));
    }

    public get dataDirectories(): DataDirectoriesClient {
        return (this._dataDirectories ??= new DataDirectoriesClient(this._options));
    }

    /**
     * Applies a given manifest to create or update resources of specific types, such as provider-account, cluster, workspace, or ml-repo.
     *
     * @param {TrueFoundry.TrueFoundryApplyRequest} request
     * @param {TrueFoundryClient.RequestOptions} requestOptions - Request-specific configuration.
     *
     * @example
     *     await client.apply({
     *         manifest: {
     *             type: "ml-repo",
     *             name: "name",
     *             storage_integration_fqn: "storage_integration_fqn",
     *             collaborators: [{
     *                     subject: "subject",
     *                     role_id: "role_id"
     *                 }]
     *         }
     *     })
     */
    public apply(
        request: TrueFoundry.TrueFoundryApplyRequest,
        requestOptions?: TrueFoundryClient.RequestOptions,
    ): core.HttpResponsePromise<TrueFoundry.TrueFoundryApplyResponse> {
        return core.HttpResponsePromise.fromPromise(this.__apply(request, requestOptions));
    }

    private async __apply(
        request: TrueFoundry.TrueFoundryApplyRequest,
        requestOptions?: TrueFoundryClient.RequestOptions,
    ): Promise<core.WithRawResponse<TrueFoundry.TrueFoundryApplyResponse>> {
        const _authRequest: core.AuthRequest = await this._options.authProvider.getAuthRequest();
        const _headers: core.Fetcher.Args["headers"] = mergeHeaders(
            _authRequest.headers,
            this._options?.headers,
            requestOptions?.headers,
        );
        const _response = await (this._options.fetcher ?? core.fetcher)({
            url: core.url.join(
                (await core.Supplier.get(this._options.baseUrl)) ??
                    (await core.Supplier.get(this._options.environment)),
                "api/svc/v1/apply",
            ),
            method: "PUT",
            headers: _headers,
            contentType: "application/json",
            queryParameters: requestOptions?.queryParams,
            requestType: "json",
            body: request,
            timeoutMs: (requestOptions?.timeoutInSeconds ?? this._options?.timeoutInSeconds ?? 60) * 1000,
            maxRetries: requestOptions?.maxRetries ?? this._options?.maxRetries,
            abortSignal: requestOptions?.abortSignal,
            fetchFn: this._options?.fetch,
            logging: this._options.logging,
        });
        if (_response.ok) {
            return { data: _response.body as TrueFoundry.TrueFoundryApplyResponse, rawResponse: _response.rawResponse };
        }

        if (_response.error.reason === "status-code") {
            throw new errors.TrueFoundryError({
                statusCode: _response.error.statusCode,
                body: _response.error.body,
                rawResponse: _response.rawResponse,
            });
        }

        return handleNonStatusCodeError(_response.error, _response.rawResponse, "PUT", "/api/svc/v1/apply");
    }

    /**
     * Deletes resources of specific types, such as provider-account, cluster, workspace, or application.
     *
     * @param {TrueFoundry.TrueFoundryDeleteRequest} request
     * @param {TrueFoundryClient.RequestOptions} requestOptions - Request-specific configuration.
     *
     * @example
     *     await client.delete({
     *         manifest: {
     *             type: "ml-repo",
     *             name: "name",
     *             storage_integration_fqn: "storage_integration_fqn",
     *             collaborators: [{
     *                     subject: "subject",
     *                     role_id: "role_id"
     *                 }]
     *         }
     *     })
     */
    public delete(
        request: TrueFoundry.TrueFoundryDeleteRequest,
        requestOptions?: TrueFoundryClient.RequestOptions,
    ): core.HttpResponsePromise<void> {
        return core.HttpResponsePromise.fromPromise(this.__delete(request, requestOptions));
    }

    private async __delete(
        request: TrueFoundry.TrueFoundryDeleteRequest,
        requestOptions?: TrueFoundryClient.RequestOptions,
    ): Promise<core.WithRawResponse<void>> {
        const _authRequest: core.AuthRequest = await this._options.authProvider.getAuthRequest();
        const _headers: core.Fetcher.Args["headers"] = mergeHeaders(
            _authRequest.headers,
            this._options?.headers,
            requestOptions?.headers,
        );
        const _response = await (this._options.fetcher ?? core.fetcher)({
            url: core.url.join(
                (await core.Supplier.get(this._options.baseUrl)) ??
                    (await core.Supplier.get(this._options.environment)),
                "api/svc/v1/delete",
            ),
            method: "POST",
            headers: _headers,
            contentType: "application/json",
            queryParameters: requestOptions?.queryParams,
            requestType: "json",
            body: request,
            timeoutMs: (requestOptions?.timeoutInSeconds ?? this._options?.timeoutInSeconds ?? 60) * 1000,
            maxRetries: requestOptions?.maxRetries ?? this._options?.maxRetries,
            abortSignal: requestOptions?.abortSignal,
            fetchFn: this._options?.fetch,
            logging: this._options.logging,
        });
        if (_response.ok) {
            return { data: undefined, rawResponse: _response.rawResponse };
        }

        if (_response.error.reason === "status-code") {
            throw new errors.TrueFoundryError({
                statusCode: _response.error.statusCode,
                body: _response.error.body,
                rawResponse: _response.rawResponse,
            });
        }

        return handleNonStatusCodeError(_response.error, _response.rawResponse, "POST", "/api/svc/v1/delete");
    }
}
